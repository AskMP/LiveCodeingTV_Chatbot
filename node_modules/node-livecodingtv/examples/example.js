/*jslint node: true*/
var LiveCodingTV = require('../'),
    ChatBot;

(function () {
    "use strict";
    ChatBot = new LiveCodingTV.ChatBot((require('./config.json')));
    ChatBot.connectToServer();
    ChatBot.on('online', function () {
        ChatBot.join('askmp');
    });
    
    ChatBot.on('message', function (data) {
        /************************************************
        *   data = {
        *       from: STRING,
        *       roll: ["owner"|"moderator"|"viewer"],
        *       message: STRING,
        *       stanza: OBJECT
        *   }
        */
    });
    
    
    // Greet any new people that are not the owner or moderator
    ChatBot.on('join', function (viewer) {
        /************************************************
        *   data = {
        *       who: STRING,
        *       roll: ["owner"|"moderator"|"viewer"]
        *   }
        */
        if (viewer.roll === "viewer") {
            setTimeout(function () {
                ChatBot.say("ChatBot welcomes you " + viewer.who + "! Iâ€™m currently in development but to see a list of my commands, type \"!chatbot\".");
            }, 4000);
        }
    });
        
    LiveCodingTV.commands.chatbot = LiveCodingTV.commands.help = function (data) {
        var description = "Describes all available commands.",
            msg = "**** ChatBot Commands ****",
            keys = Object.keys(LiveCodingTV.commands),
            desc;
        if (data) {
            keys.forEach(function (cmd) {
                desc = LiveCodingTV.commands[cmd]();
                msg += (desc) ? "\r\n!" + cmd + ": " + desc : "";
            });
            ChatBot.say(msg);
        } else {
            return description;
        }
    };
    
}());